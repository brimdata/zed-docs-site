<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Zed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Zed Atom Feed"><title data-rh="true">lake | Zed</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zed.brimdata.io/docs/tutorials/lake"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="lake | Zed"><meta data-rh="true" name="description" content="This document will soon be updated as part of issue 3604"><meta data-rh="true" property="og:description" content="This document will soon be updated as part of issue 3604"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zed.brimdata.io/docs/tutorials/lake"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/tutorials/lake" hreflang="en"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/tutorials/lake" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d4a07bc2.css">
<link rel="preload" href="/assets/js/runtime~main.92d6069c.js" as="script">
<link rel="preload" href="/assets/js/main.c74a1d27.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Zed</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Zed Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/formats/">formats</a><button aria-label="Toggle the collapsible sidebar category &#x27;formats&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/tutorials/">tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/join">Join Primer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/lake">lake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/schools">A Tour of Zed with Schools Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/zed-primer">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/zq-primer">A Tour of `zq`</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/zed/">zed</a><button aria-label="Toggle the collapsible sidebar category &#x27;zed&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/zq/">zq</a><button aria-label="Toggle the collapsible sidebar category &#x27;zq&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/tutorials/">tutorials</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/tutorials/lake">lake</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>lake</h1></header><p><strong>This document will soon be updated as part of issue 3604</strong></p><h1>Zed lake tutorial</h1><blockquote><p>DISCLAIMER: This tutorial was drafted assuming on an older version of the
Zed lake design and is out of date.  We will soon update this document
to reflect our more recent <a href="/docs/zed/">Git-inspired design</a>.</p></blockquote><hr><blockquote><p>A video walk-through of some of what&#x27;s shown below is captured in
<a href="https://www.youtube.com/watch?v=ldrEadAQYTM&amp;t=46m00s" target="_blank" rel="noopener noreferrer">this excerpt from a recent Zeek From Home event</a>.</p></blockquote><hr><p>This documents describes the <code>zed</code> command, a work-in-progress for
indexing and searching Zed data lakes.</p><h1>Contents</h1><ul><li><a href="#test-data">Test data</a></li><li><a href="#ingesting-the-data">Ingesting the data</a></li><li><a href="#initializing-the-archive">Initializing the archive</a></li><li><a href="#counting-as-hello-world">Counting as &quot;hello world&quot;</a></li><li><a href="#search-for-an-ip">Search for an IP</a></li><li><a href="#indexes">Indexes</a></li><li><a href="#creating-more-indexes">Creating more indexes</a></li><li><a href="#operating-directly-on-indexes">Operating directly on indexes</a></li><li><a href="#custom-indexes-storing-aggregations-in-an-index">Custom indexes: Storing aggregations in an index</a></li><li><a href="#zed-lake-find-with-custom-index"><code>zed find</code> with custom index</a></li><li><a href="#multi-key-custom-indexes">Multi-key custom indexes</a></li><li><a href="#map-reduce">Map-reduce</a></li><li><a href="#simple-graph-queries">Simple graph queries</a></li><li><a href="#a-final-word-about-pipes">A final word about pipes...</a></li><li><a href="#cleanup">Cleanup</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="test-data">Test data<a class="hash-link" href="#test-data" title="Direct link to heading">‚Äã</a></h2><p>We&#x27;ll use the <a href="/docs/formats/zng">ZNG</a>-format test data from here:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/brimdata/zed-sample-data/tree/main/zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can copy just the zng data directory needed for this demo
into your current directory using subversion:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">svn checkout https://github.com/brimdata/zed-sample-data/trunk/zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or, you can clone the whole data repo using git and symlink the zng dir:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">git clone --depth=1 https://github.com/brimdata/zed-sample-data.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s zed-sample-data/zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ingesting-the-data">Ingesting the data<a class="hash-link" href="#ingesting-the-data" title="Direct link to heading">‚Äã</a></h2><p>Let&#x27;s take those logs and ingest them into a directory.  Often we&#x27;d keep our
archive somewhere like <a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Amazon S3</a>, but since we&#x27;re
just doing a quick test we&#x27;ll use local temp space.  We&#x27;ll make it easier to
run all the commands by setting an environment variable pointing to the root of
the logs tree.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export ZED_LAKE=/tmp/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir $ZED_LAKE</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now, let&#x27;s ingest the data using <code>zed load</code>.  We are working on more
sophisticated ways to ingest data (e.g., arbitrary partition keys and
auto-sizing of partitions) but for now <code>zed load</code> just chops its input into
LZ4-compressed chunk files of approximately equal size, each sorted by
timestamp in descending order.  We&#x27;ll chop into chunks of approximately 25MB
each, which is very small, but in this example the data set is fairly small
(71 MB of LZ4-compressed ZNG) and you can always try it out on larger data
sets:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed load -s 25MB zng/*.gz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="initializing-the-archive">Initializing the archive<a class="hash-link" href="#initializing-the-archive" title="Direct link to heading">‚Äã</a></h2><p>Try <code>zed ls</code> now and you can see the lake directories.  This is where
<code>zed</code> puts lots of interesting data associated with each chunk file of the ingested logs.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed ls</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="counting-as-hello-world">Counting as &quot;hello world&quot;<a class="hash-link" href="#counting-as-hello-world" title="Direct link to heading">‚Äã</a></h2><p>Now that it&#x27;s set up, you can do stuff with the archive.  Maybe the simplest thing
is to count up all the events across the archive.  Since the chunk files
are in different directories in the archive, we need a way to run <code>zed query</code> over
all of them and aggregate the result.</p><p>The <code>zq</code> subcommand of <code>zed</code> lets you do this.  Here&#x27;s how you run <code>zq</code>
on the data of every log in the archive:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed query &quot;count()&quot; &gt; counts.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This invocation of <code>zed</code> traverses the lake, applies the Zed &quot;count()&quot; operator
on the data from all the chunks, and writes the output as a stream of zng data.
By default, the output is sent to stdout, which means you can simply pipe the
resulting stream to a vanilla <code>zq</code> command that specifies <code>-</code> to expect the
stream on stdin, then show the output as a table:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed query &quot;count()&quot; | zq -f table -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which, for example, results in:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1462078</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>zq</code> common options are also available when invoking <code>zed query</code>, so instead of a
pipeline we can get the same result in one shot via:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed query -f table &quot;count()&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>zed query</code> treats the lake as if it were one large set of data, regardless
of how many chunk files are in it. It&#x27;s also possible to perform queries for
each chunk; that&#x27;s done with a command called <code>zed map</code>.
This invocation of <code>zed</code>
traverses the archive, applies a query to each log file, and writes the output
to either stdout, or to a new file in the chunk&#x27;s directory.</p><p>Here&#x27;s an example using the same &quot;count()&quot; query as before:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map -f text &quot;count()&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which results in:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">275745</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">276326</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">290789</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">619218</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You could take the stream of event counts and sum them to get a total:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map &quot;count()&quot; | zq -f text &quot;sum(count)&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which should have the same result as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f text &quot;count()&quot; zng/*.gz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1462078</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="search-for-an-ip">Search for an IP<a class="hash-link" href="#search-for-an-ip" title="Direct link to heading">‚Äã</a></h2><p>Now let&#x27;s say you want to search for a particular IP across the Zed lake.
This is easy. You just say:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed query -Z &quot;id.orig_h=10.10.23.2&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which gives this result in the <a href="/docs/formats/zson">ZSON</a> format.  ZSON
describes the complete detail from the ZNG stream as human-readable text.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _path: &quot;conn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts: 2018-03-24T17:15:21.307472Z,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid: &quot;C4NuQHXpLAuXjndmi&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orig_h: 10.10.23.2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orig_p: 11 (port=(uint16)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp_h: 10.0.0.111,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp_p: 0 (port)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proto: &quot;icmp&quot; (=zenum),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service: null (string),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration: 21m0.819589s,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orig_bytes: 23184 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp_bytes: 0 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn_state: &quot;OTH&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local_orig: null (bool),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local_resp: null (bool),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    missed_bytes: 0 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    history: null (string),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orig_pkts: 828 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orig_ip_bytes: 46368 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp_pkts: 0 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp_ip_bytes: 0 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tunnel_parents: null (|[string]|)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>(If you want to learn more about this format, check out the
<a href="/docs/formats/zson">ZSON spec</a>.)</p><p>You might have noticed that this is kind of slow --- like all the counting above ---
because every record is read to search for that IP.</p><p>We can speed this up by building an index.<br>
<code>zed</code> lets you pretty much build any
sort of index you&#x27;d like and you can even embed whatever custom Zed analytics
you would like in a search index.  But for now, let&#x27;s look at just IP addresses.</p><blockquote><p>NOTE: we are in the process of changing <code>zed index</code> to operate over
specific key ranges instead of the arbitrary boundaries formed with lake chunks.
For now, this describes the old behavior.</p></blockquote><p>The <code>zed index</code> command makes it easy to index any field or any Zed type.
e.g., to index every value that is of type IP, we simply say</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed index create :ip</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For each Zed lake chunk, this command will find every field of type IP in every
record and add a key for that field&#x27;s value to chunk&#x27;s index file.</p><p>Hmm that was interesting.  If you type</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed ls -l</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You will see all the indexes left behind. They are just zng files.
If you want to see one, just look at it with zq, e.g.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">find $ZED_LAKE -name idx-* | head -n 1 | xargs zq -z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now if you run <code>zed find</code>, it will efficiently look through all the index files
instead of the raw lake data and run much faster...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -f table :ip=10.10.23.2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the output here, you&#x27;ll see this IP exists in exactly one lake chunk:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/logs/zd/20180324/d-1jQ2dLYVOL4NSSYCYC4P400ZfPN.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>(In this and later outputs in this README that show pathnames in the archive,
the portion of the paths following <code>d-</code> will be unique and hence differ in your
output if you repeat the commands.)</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="indexes">Indexes<a class="hash-link" href="#indexes" title="Direct link to heading">‚Äã</a></h2><p>A Zed index is a zng index file that pertains to just one
chunk of lake data and represents just one indexing rule.  If you&#x27;re curious about
what&#x27;s in the index, it&#x27;s just a sorted list of keyed records along with some
additional zng streams that comprise a constant b-tree index into the sorted list.
But the cool thing here is that everything is just a zng stream.</p><p>Instead of building a massive, inverted index with glorious roaring
bitmaps that tell you exactly where each event is in the event store, our model
is to instead build lots of small indexes for each log chunk and index different
things in the different indexes.  This approach dovetails with the modern
cloud warehouse approach of scanning native-cloud storage objets and efficiently
pruning objects that are not needed from the scan.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="creating-more-indexes">Creating more indexes<a class="hash-link" href="#creating-more-indexes" title="Direct link to heading">‚Äã</a></h2><p>The beauty of this approach is that you can add and delete indexes
whenever you want.  No need to suffer the fate of a massive reindexing
job when you have a new idea about what to index.</p><p>So, let&#x27;s say you later decide you want searches over the &quot;uri&quot; field to run fast.
You just run <code>zed index</code> again but with different parameters:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed index create uri</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And now you can run field matches on <code>uri</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -f table uri=/file</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and you&#x27;ll find &quot;hits&quot; in multiple lake chunks:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/logs/zd/20180324/d-1jQ2d5DwDHJULCRN6gq84IwArbb.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/logs/zd/20180324/d-1jQ2co6Ttjk9wEUdzI2yW7koYtB.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="operating-directly-on-indexes">Operating directly on indexes<a class="hash-link" href="#operating-directly-on-indexes" title="Direct link to heading">‚Äã</a></h2><p>Let&#x27;s say instead of searching for what lake chunk a value is in, we want to
actually pull out the zng records that comprise the index.  This turns out
to be really powerful in general, but to give you a taste here, you can say...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -z :ip=10.47.21.138</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>-z</code> says to produce compact ZSON output instead of a table,
and you&#x27;ll get this...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{key:10.47.21.138,count:1 (uint64),_log:&quot;/tmp/logs/zd/20180324/d-1qCzy6mfDLtsDXeEU1EJxSn1DTi.zng&quot; (=zfile),first:2018-03-24T17:36:30.01359Z,last:2018-03-24T17:15:20.600725Z} (=0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{key:10.47.21.138,count:13,_log:&quot;/tmp/logs/zd/20180324/d-1qCzyJtVcZh8fLyFgTJl0fcoyrp.zng&quot;,first:2018-03-24T17:29:56.0241Z,last:2018-03-24T17:15:20.601374Z} (0)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The find command adds a column called &quot;_log&quot; (which can be disabled
or customized to a different field name) so you can see where the
search hits came from even when they are combined into a zng stream.
The type of the path field is a named type --- a sort of logical type ---
where a client can infer the type &quot;zfile&quot; refers to a zng data file.</p><p>But, what if we wanted to put even more information in the index
alongside each key?  If we could, it seems we could do arbitrarily
interesting things with this...</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="custom-indexes-storing-aggregations-in-an-index">Custom indexes: Storing aggregations in an index<a class="hash-link" href="#custom-indexes-storing-aggregations-in-an-index" title="Direct link to heading">‚Äã</a></h2><p>Since everything is a zng file, you can create whatever values you want to
go along with your index keys using Zed queries.  Why don&#x27;t we go back to counting?</p><p>Let&#x27;s create an index keyed on the field id.orig_h and for each unique value of
this key, we&#x27;ll compute the number of times that value appeared for each zeek
log type.  To do this, we&#x27;ll run <code>zed index</code> in a way that leaves
these results behind in each lake directory:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed index create -q -o custom.zng -k id.orig_h -z &quot;count() by _path, id.orig_h | sort id.orig_h&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Unlike for the field and type indexes we created previously, for
custom indexes the index file name must be specified via the <code>-o</code>
flag.  You can run ls to see the custom index files are indeed there:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed ls custom.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To see what&#x27;s in it:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">find $ZED_LAKE -name idx-$(zed index ls -f zng | zq -f text &#x27;desc=&quot;zed-custom.zng&quot; | cut id&#x27; -).zng | head -n 1 | xargs zq -f table &#x27;head 10&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can see the IPs, counts, and _path strings.</p><p>At the bottom you&#x27;ll also find a record describing the index layout. To
see it:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">find $ZED_LAKE -name idx-$(zed index ls -f zng | zq -f text &#x27;desc=&quot;zed-custom.zng&quot; | cut id&#x27; -).zng | head -n 1 | xargs zq -f table &#x27;tail 1&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="zed-find-with-custom-index"><code>zed find</code> with custom index<a class="hash-link" href="#zed-find-with-custom-index" title="Direct link to heading">‚Äã</a></h2><p>And now I can go back to my example from before and use <code>zed find</code> on the custom
index:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -z -x custom.zng 10.164.94.120</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now we&#x27;re talking!  And if you take the results and do a little more math to
aggregate the aggregations, like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -x custom.zng 10.164.94.120 | zq -f table &quot;count=sum(count) by _path | sort -r&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You&#x27;ll get</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">_path       count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conn        26726</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http        13485</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl         9538</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rdp         4116</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smtp        1178</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">weird       316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ftp         93</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ntlm        80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smb_mapping 65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notice      35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpd         24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dns         8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rfb         3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dce_rpc     2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh         1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smb_files   1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can compute this aggregation now for any IP in the index
without reading any of the original data files!  You&#x27;ll get the same
output from this...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;id.orig_h=10.164.94.120&quot; zng/*.gz | zq -f table &quot;count() by _path | sort -r&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>But using <code>zed</code> with the custom indexes is MUCH faster.  Pretty cool.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="multi-key-custom-indexes">Multi-key custom indexes<a class="hash-link" href="#multi-key-custom-indexes" title="Direct link to heading">‚Äã</a></h2><p>In addition to a single-key search, you can build indexes with multiple keys
in each row.  To do this, you list the keys in order
of precedence, e.g., primary, secondary, etc.  Then, you can perform searches
using one or more keys in that order where any missing keys are &quot;don&#x27;t cares&quot;
and will match all search rows with any value.</p><p>For example, let&#x27;s say we want to build an index that has primary key
<code>id.resp_h</code> and secondary key <code>id.orig_h</code> from all the conn logs where we
cache the sum of response bytes to each originator.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed index create -o custom2.zng -k id.resp_h,id.orig_h -z &quot;_path=conn | resp_bytes=sum(resp_bytes) by id.resp_h,id.orig_h | sort id.resp_h,id.orig_h&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And now we can search with a primary key and a secondary key, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -Z -x custom2.zng 216.58.193.206 10.47.6.173</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which produces just one record as this pair appears in only one log file.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp_h: 216.58.193.206,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orig_h: 10.47.6.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp_bytes: 5112 (uint64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _log: &quot;/tmp/logs/zd/20180324/d-1q85q79hAjNCHg5Wx0EQlkulmKU.zng&quot; (=zfile),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    first: 2018-03-24T17:29:56.0241Z,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    last: 2018-03-24T17:15:20.601374Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} (=0)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The nice thing here is that you can also just specify a primary key, which will
issue a search that returns all the index hits that have the primary key with
any value for the secondary key, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -z -x custom2.zng 216.58.193.206</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and of course you can sum up all the response bytes to get a table and output
it as text...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -x custom2.zng 216.58.193.206 | zq -f text &quot;sum(resp_bytes)&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that you can&#x27;t &quot;wild card&quot; the primary key when doing a search via
<code>zed find</code> because the index is sorted by primary key first, then secondary
key, and so forth, and efficient lookups are carried out by traversing the
b-tree index structure of these sorted keys.  But remember,
everything is a zng file, so you can do a brute-force search on the base-layer
of the index, e.g., to look for all the instances of a value in the secondary
key position (ignoring the primary key) by using
<code>zed map</code> instead of <code>zed find</code>.</p><p>So, let&#x27;s say we wanted
a count of all bytes received by 10.47.6.173 as the originator, which is the
secondary key.  While we could build a different custom index where <code>id.orig_h</code>
is the primary key, we could also just scan the custom2 index using brute force:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map id.orig_h=10.47.6.173 idx-$(zed index ls -f zng | zq -f text &#x27;desc=&quot;zed-custom2.zng&quot; | cut id&#x27; -).zng | zq -f text &quot;sum(resp_bytes)&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Even though this is a &quot;brute force scan&quot;, it&#x27;s a brute force scan of only this
one index so it runs much faster than scanning all of the original
log data to perform the same query.</p><p>But to double check here, you can run</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map id.orig_h=10.47.6.173 | zq -f text &quot;sum(resp_bytes)&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and you will get the same answer.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="map-reduce">Map-reduce<a class="hash-link" href="#map-reduce" title="Direct link to heading">‚Äã</a></h2><p>What&#x27;s really going on here is map-reduce style computation on your log archives
without having to set up a spark cluster and write java map-reduce classes.</p><p>The classic map-reduce example is word count.  Let&#x27;s do this example with
the uri field in http logs.  First, we map each record that has a uri
to a new record with that uri and a count of 1:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map -q -o words.zng &quot;uri != null | cut uri | put count=1&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>again you can look at one of the files...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">find $ZED_LAKE -name words.zng ! -size 0 | head -n 1 | xargs zq -z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now we reduce by aggregating the uri and summing the counts:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map -q -o wordcounts.zng &quot;sum(count) by uri | cut uri,count=sum&quot; words.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If we were dealing with a huge archive, we could do an approximation by taking
the top 1000 in each lake directory then we could aggregate with another zq
command at the top-level:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map &quot;sort -r count | head 1000&quot; wordcounts.zng | zq -f table &quot;sum(count) by uri | sort -r sum | head 10&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and you get the top-ten URIs...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">uri                     sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/wordpress/wp-login.php 6516</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/                       5848</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/3/6            4677</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/1/2            4645</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/4/7            4639</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/2/3            4638</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/4/8            4638</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/1/1            4636</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/6/12           4634</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/api/get/9/18           4627</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Pretty cool!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="simple-graph-queries">Simple graph queries<a class="hash-link" href="#simple-graph-queries" title="Direct link to heading">‚Äã</a></h2><p>Here is another example to illustrate the power of <code>zed</code>.  Just like you can
build search indexes with arbitrary Zed queries, you can also build graph indexes
to hold edge lists and node attributes, providing an efficient means to do
topological queries of graph data structures.  While this doesn&#x27;t provide a
full-featured graph database like <a href="https://github.com/neo4j/neo4j" target="_blank" rel="noopener noreferrer">neo4j</a>,
it does provide a nice way to do many types of graph queries that
could prove useful for your archive analytics.</p><p>For example, to build a searchable edge list comprising communicating IP addresses,
run the following commands to a create a multi-key search index
keyed by all unique instances of IP address pairs (in both directions)
where each index includes a count of the occurrences.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed map -o forward.zng &quot;id.orig_h != null | put from_addr=id.orig_h,to_addr=id.resp_h | count() by from_addr,to_addr&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zed map -o reverse.zng &quot;id.orig_h != null | put from_addr=id.resp_h,to_addr=id.orig_h | count() by from_addr,to_addr&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zed map -o directed-pairs.zng &quot;count=sum(count) by from_addr,to_addr | sort from_addr,to_addr&quot; forward.zng reverse.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zed index create -i directed-pairs.zng -o graph.zng -k from_addr,to_addr -z &quot;*&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>(Note: there is a small change we can make to the Zed language to do this with one
command... coming soon.)</p></blockquote><p>This creates an index called &quot;graph&quot; that you can use to search for IP address
pair relationships, e.g., you can say</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -x graph.zng 216.58.193.195 | zq -f table &quot;count=sum(count) by from_addr,to_addr | sort -r count&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>to get a listing of all of the edges from IP 216.58.193.195 to any other IP,
which looks like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from_addr      to_addr      count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.2.155  55</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.2.100  47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.6.162  31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.7.150  30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.5.153  26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.3.154  25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.5.152  24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.8.19   23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">216.58.193.195 10.47.7.154  19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To view this with d3, we can collect up the edges emanating from a few IP addresses
and format the output as NDJSON in the format expected by bostock&#x27;s
force-directed graph.
This command sequence will collect up the edges into <code>edges.njdson</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed find -z -x graph.zng 216.58.193.195 | zq &quot;count() by from_addr,to_addr&quot; - &gt; edges.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zed find -z -x graph.zng 10.47.6.162 | zq &quot;count() by from_addr,to_addr&quot; - &gt;&gt; edges.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zed find -z -x graph.zng 10.47.5.153 | zq &quot;count() by from_addr,to_addr&quot; - &gt;&gt; edges.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -f json &quot;value=sum(count) by from_addr,to_addr | cut source=from_addr,target=to_addr,value&quot; edges.zng &gt;&gt; edges.ndjson</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>(Note: with a few additions to Zed, we can make this much simpler and
more efficient.  Coming soon.  Also, we should be able to say <code>group by node</code>,
which implies no reducer and emits columns with just the group-by keys.)</p></blockquote><p>Now that we have the edges in <code>edges.ndjson</code>, let&#x27;s grab all the nodes
in the graph and put them in the form expected by bostock using this command sequence:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;count() by from_addr | put id=from_addr&quot; edges.zng &gt; nodes.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;count() by to_addr | put id=to_addr&quot; edges.zng &gt;&gt; nodes.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -f json &quot;count() by id | cut id | put addr_group=1&quot; nodes.zng &gt; nodes.ndjson</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To make a simple demo of this concept here, I cut and paste the nodes and edges
data into a gist and added some commas with <code>awk</code>.  Check out this
<a href="https://bl.ocks.org/mccanne/ff6f703cf202aee59197fff1f63d04fe" target="_blank" rel="noopener noreferrer">d3 &quot;block&quot;</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="a-final-word-about-pipes">A final word about pipes...<a class="hash-link" href="#a-final-word-about-pipes" title="Direct link to heading">‚Äã</a></h2><p>As you&#x27;ve likely noticed, we love pipes in the zq project. Make a test file:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;head 10000&quot; zng/* &gt; pipes.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can use pipes in Zed expressions like you&#x27;ve seen above:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f table &quot;orig_bytes &gt; 100 | count() by id.resp_p | sort -r&quot; pipes.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or you can pipe the output of one zq to another...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;orig_bytes &gt; 100 | count() by id.resp_p&quot; pipes.zng | zq -f table &quot;sort -r&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We were careful to make the output of zq just a stream of zng records.
So whether you are piping within a Zed query, or between zq commands, or
between zed and zq, or over the network (ssh zq...), it&#x27;s all the same.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;orig_bytes &gt; 100&quot; pipes.zng | zq &quot;count() by id.resp_p&quot; - | zq -f table &quot;sort -r&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In fact, files are self-contained zng streams, so you can just cat them together
and you still end up with a valid zng stream</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cat pipes.zng pipes.zng &gt; pipes2.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -f text &quot;count()&quot; pipes.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -f text &quot;count()&quot; pipes2.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="cleanup">Cleanup<a class="hash-link" href="#cleanup" title="Direct link to heading">‚Äã</a></h2><p>To clean out all the files you&#x27;ve created in the lake directories and
start over, just run</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zed rmdirs $ZED_LAKE</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/brimdata/zed-docs/tree/main/docs/tutorials/lake.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorials/join"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Join Primer</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/tutorials/schools"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">A Tour of Zed with Schools Data</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#test-data" class="table-of-contents__link toc-highlight">Test data</a></li><li><a href="#ingesting-the-data" class="table-of-contents__link toc-highlight">Ingesting the data</a></li><li><a href="#initializing-the-archive" class="table-of-contents__link toc-highlight">Initializing the archive</a></li><li><a href="#counting-as-hello-world" class="table-of-contents__link toc-highlight">Counting as &quot;hello world&quot;</a></li><li><a href="#search-for-an-ip" class="table-of-contents__link toc-highlight">Search for an IP</a></li><li><a href="#indexes" class="table-of-contents__link toc-highlight">Indexes</a></li><li><a href="#creating-more-indexes" class="table-of-contents__link toc-highlight">Creating more indexes</a></li><li><a href="#operating-directly-on-indexes" class="table-of-contents__link toc-highlight">Operating directly on indexes</a></li><li><a href="#custom-indexes-storing-aggregations-in-an-index" class="table-of-contents__link toc-highlight">Custom indexes: Storing aggregations in an index</a></li><li><a href="#zed-find-with-custom-index" class="table-of-contents__link toc-highlight"><code>zed find</code> with custom index</a></li><li><a href="#multi-key-custom-indexes" class="table-of-contents__link toc-highlight">Multi-key custom indexes</a></li><li><a href="#map-reduce" class="table-of-contents__link toc-highlight">Map-reduce</a></li><li><a href="#simple-graph-queries" class="table-of-contents__link toc-highlight">Simple graph queries</a></li><li><a href="#a-final-word-about-pipes" class="table-of-contents__link toc-highlight">A final word about pipes...</a></li><li><a href="#cleanup" class="table-of-contents__link toc-highlight">Cleanup</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/join-slack/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Brim Data, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.92d6069c.js"></script>
<script src="/assets/js/main.c74a1d27.js"></script>
</body>
</html>